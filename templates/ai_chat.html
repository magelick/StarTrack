{% extends 'base.html' %}

{% block title %}
Тестирование чата с AI
{% endblock %}

{% block content %}
<h1>Чат с Gemini AI</h1>
<div>
    <div id="chat-log" style="border: 1px solid black; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px;">
        <p><em>Подключение к чату...</em></p>
    </div>

    <input id="messageInput" type="text" placeholder="Введите ваше сообщение..." style="width: 80%;" />
    <button onclick="sendMessage()" style="width: 18%;">Отправить</button>
</div>

<script>
    // Создаем подключение к WebSocket
    const websocket = new WebSocket("http://localhost:8001/api/ai/chat");

    const chatLog = document.getElementById("chat-log");
    const messageInput = document.getElementById("messageInput");

    // Обработка входящих сообщений от WebSocket
    websocket.onmessage = function(event) {
        const message = event.data;

        // Отображение ответа AI в чате
        const messageElement = document.createElement("p");
        messageElement.textContent = "AI: " + message;
        chatLog.appendChild(messageElement);

        // Прокручиваем чат до последнего сообщения
        chatLog.scrollTop = chatLog.scrollHeight;
    };

    websocket.onopen = function() {
        const connectMessage = document.createElement("p");
        connectMessage.textContent = "Подключение установлено.";
        chatLog.appendChild(connectMessage);
    };

    websocket.onclose = function() {
        const disconnectMessage = document.createElement("p");
        disconnectMessage.textContent = "Подключение закрыто.";
        chatLog.appendChild(disconnectMessage);
    };

    // Функция для отправки сообщений в WebSocket
    function sendMessage() {
        const message = messageInput.value;
        if (message) {
            const messageElement = document.createElement("p");
            messageElement.textContent = "Вы: " + message;
            chatLog.appendChild(messageElement);

            // Отправка сообщения через WebSocket
            websocket.send(message);

            // Очищаем поле ввода
            messageInput.value = '';

            // Прокручиваем чат до последнего сообщения
            chatLog.scrollTop = chatLog.scrollHeight;
        }
    }
</script>
{% endblock %}